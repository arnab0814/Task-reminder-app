<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Task List</title>
</head>
<body>

<h1>All Tasks</h1>

<div th:if="${successMessage}">
    <p th:text="${successMessage}" style="color: green;"></p>
</div>

<table border="1" cellpadding="8" cellspacing="0">
    <thead>
    <tr>
        <th>ID</th>
        <th>Task Name</th>
        <th>Description</th>
        <th>Priority</th>
        <th>Status</th>
        <th>Due Date</th>
        <th>Created On</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="task : ${taskPage.content}">
        <td th:text="${task.id}"></td>

        <td>
            <span th:if="${task.status != null and task.status.name() == 'DONE'}"
                  style="text-decoration: line-through; color:gray;"
                  th:text="${task.name}"></span>
            <span th:if="${task.status == null or task.status.name() != 'DONE'}"
                  th:text="${task.name}"></span>
        </td>

        <td th:text="${task.description}"></td>
        <td th:text="${task.priority}"></td>

        <td th:text="${task.status != null ? task.status.name() : 'PENDING'}"></td>

        <td th:text="${task.dueDate != null ? #temporals.format(task.dueDate, 'dd-MM-yyyy') : 'N/A'}"></td>

        <td th:text="${task.createdAt != null ? #temporals.format(task.createdAt,'dd-MM-yyyy HH:mm') : 'N/A'}"></td>

        <td>
            <a th:href="@{/tasks/edit/{id}(id=${task.id})}">Edit</a> |
            <a th:href="@{/tasks/delete/{id}(id=${task.id})}"
               onclick="return confirm('Are you sure you want to delete this task?');">Delete</a>

            <span th:if="${task.status == null or task.status.name() != 'DONE'}">
                &nbsp;|&nbsp;
                <a th:href="@{/tasks/done/{id}(id=${task.id})}"
                   onclick="return confirm('Mark this task as done?');">Mark Done</a>
            </span>
        </td>
    </tr>

    <tr th:if="${#lists.isEmpty(taskPage.content)}">
        <td colspan="8">No tasks found.</td>
    </tr>
    </tbody>
</table>

<div th:if="${totalPages > 1}">
    <span>Page [[${currentPage + 1}]] of [[${totalPages}]]</span>
    <br/><br/>

    <a th:if="${!taskPage.first}"
       th:href="@{/tasks/list(page=0, size=${pageSize})}">&laquo; First</a>

    <a th:if="${taskPage.hasPrevious()}"
       th:href="@{/tasks/list(page=${currentPage - 1}, size=${pageSize})}">&lt; Prev</a>

    <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
        <a th:if="${i != currentPage}"
           th:href="@{/tasks/list(page=${i}, size=${pageSize})}"
           th:text="${i + 1}">1</a>
        <span th:if="${i == currentPage}"
              th:text="${i + 1}"
              style="font-weight: bold; text-decoration: underline;"></span>
    </span>

    <a th:if="${taskPage.hasNext()}"
       th:href="@{/tasks/list(page=${currentPage + 1}, size=${pageSize})}">Next &gt;</a>

    <a th:if="${!taskPage.last}"
       th:href="@{/tasks/list(page=${totalPages - 1}, size=${pageSize})}">Last &raquo;</a>
</div>

<p>
    <a th:href="@{/tasks/new}">Add New Task</a>
</p>

</body>
</html>
